<?xml version="1.0" encoding="UTF-8"?>
<topology>
	<gateway>
		<provider>
			<role>authentication</role>
			<name>ShiroProvider</name>
			<enabled>true</enabled>
			<param>
				<name>sessionTimeout</name>
				<value>30</value>
			</param>
			<param>
				<name>main.ldapRealm</name>
				<value>org.apache.hadoop.gateway.shirorealm.KnoxLdapRealm</value>
			</param>
			<!-- changes for AD/user sync -->
			<param>
				<name>main.ldapContextFactory</name>
				<value>org.apache.hadoop.gateway.shirorealm.KnoxLdapContextFactory</value>
			</param>
			<param>
				<name>main.ldapRealm.contextFactory</name>
				<value>$ldapContextFactory</value>
			</param>
			<param>
				<name>main.ldapRealm.contextFactory.url</name>
				<value>ldap://adserver.hortonworks.com:389</value>
			</param>
			<param>
				<name>main.ldapRealm.contextFactory.systemUsername</name>
				<value>CN=hdadmin,OU=hadoop,DC=hortonworks,DC=lab,DC=com</value>
			</param>
			<param>
				<name>main.ldapRealm.contextFactory.systemPassword</name>
				<value>Hadoop@1</value>
			</param>
			<param>
				<name>main.ldapRealm.contextFactory.authenticationMechanism</name>
				<value>simple</value>
			</param>
			<!--
			<param><name>main.ldapRealm.userDnTemplate</name><value>CN={0},OU=hadoop,DC=hortonworks,DC=lab,DC=com</value></param>
			-->
			<param>
				<name>main.ldapRealm.searchBase</name>
				<value>OU=hadoop,DC=hortonworks,DC=lab,DC=com</value>
			</param>
			<param>
				<name>main.ldapRealm.userObjectClass</name>
				<value>person</value>
			</param>
			<param>
				<name>main.ldapRealm.userSearchAttributeName</name>
				<value>sAMAccountName</value>
			</param>
			<param>
				<name>main.ldapRealm.authorizationEnabled</name>
				<value>true</value>
			</param>
			<param>
				<name>main.ldapRealm.groupSearchBase</name>
				<value>OU=hadoop,DC=hortonworks,DC=lab,DC=com</value>
			</param>
			<param>
				<name>main.ldapRealm.groupObjectClass</name>
				<value>group</value>
			</param>
			<param>
				<name>main.ldapRealm.groupIdAttribute</name>
				<value>cn</value>
			</param>
			<param>
				<name>urls./**</name>
				<value>authcBasic</value>
			</param>
		</provider>
		<provider>
			<role>authorization</role>
			<name>AclsAuthz</name>
			<enabled>true</enabled>
			<param name="knox.acl" value="*;*;*" />
		</provider>
		<!-- Use XASecurePDPKnox for Ranger authorization -->
		
		<provider>
			<role>identity-assertion</role>
			<name>Default</name>
			<enabled>true</enabled>
		</provider>
		<!-- HA Provider Configs -->
		<provider>
			<role>ha</role>
			<name>HaProvider</name>
			<enabled>true</enabled>
			<param>
				<name>WEBHDFS</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;maxRetryAttempts=300;retrySleep=1000;enabled=true</value>
			</param>
			<param>
				<name>RESOURCEMANAGER</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true</value>
			</param>
			<param>
				<name>YARNUI</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true</value>
			</param>
			<param>
				<name>HDFSUI</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;maxRetryAttempts=300;retrySleep=1000;enabled=true</value>
			</param>
			<param>
				<name>OOZIE</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true</value>
			</param>
			<param>
				<name>HBASE</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true</value>
			</param>
			<param>
				<name>WEBHCAT</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true</value>
			</param>
			<param>
				<name>HIVE</name>
				<value>maxFailoverAttempts=3;failoverSleep=1000;enabled=true;zookeeperEnsemble=uds-ct1-mn1.ref.dab.02.net:2181,uds-ct1-mn2.ref.dab.02.net:2181,uds-ct1-mn3.ref.dab.02.net:2181;zookeeperNamespace=hiveserver2</value>
			</param>
		</provider>
	</gateway>
	<!-- Services -->
	<service>
		<role>NAMENODE</role>
		<url>hdfs://{{namenode_host}}:{{namenode_rpc_port}}</url>
	</service>
	<service>
		<role>JOBTRACKER</role>
		<url>rpc://{{rm_host}}:{{jt_rpc_port}}</url>
	</service>
	<service>
		<role>WEBHDFS</role>
      {{webhdfs_service_urls}}
   
	
	</service>
	<service>
		<role>WEBHCAT</role>
		<url>http://{{webhcat_server_host}}:{{templeton_port}}/templeton</url>
	</service>
	<service>
		<role>OOZIE</role>
		<url>http://{{oozie_server_host}}:{{oozie_server_port}}/oozie</url>
	</service>
	<service>
		<role>WEBHBASE</role>
		<url>http://{{hbase_master_host}}:{{hbase_master_port}}</url>
	</service>
	<service>
		<role>HIVE</role>
		<url>http://{{hive_server_host}}:{{hive_http_port}}/{{hive_http_path}}</url>
	</service>
	<service>
		<role>RESOURCEMANAGER</role>
		<url>http://{{rm_host}}:{{rm_port}}/ws</url>
	</service>
	<service>
		<role>HDFSUI</role>
		<url>http://your.namenode1.hostname.com:50070</url>
		<url>http://your.namenode2.hostname.com:50070</url>
	</service>
	<service>
		<role>YARNUI</role>
		<url>http://your.rm1.hostname.com:8088</url>
		<url>http://your.rm2.hostname.com:8088</url>
	</service>
	<service>
		<role>JOBHISTORYUI</role>
		<url>http://your.jhs.hostname.com:19888</url>
	</service>
	<service>
		<role>AMBARI</role>
		<url>http://your.ambari.hostname.com:8080</url>
	</service>
	<service>
		<role>AMBARIUI</role>
		<url>http://your.ambari.hostname.com:8080</url>
	</service>
	<service>
		<role>RANGER</role>
		<url>http://your.ranger.hostname.com:6180</url>
	</service>
	<service>
		<role>RANGERUI</role>
		<url>http://your.ranger.hostname.com:6180</url>
	</service>
	<service>
		<role>HBASEUI</role>
		<url>http://hbase1.hostname.com:16010/hbase</url>
		<url>http://hbase2.hostname.com:16010/hbase</url>
	</service>
	<service>
		<role>OOZIEUI</role>
		<url>http://oozie.hostname.com:11000/oozie</url>
	</service>
	<service>
		<role>DRUID-COORDINATOR-UI</role>
      {{druid_coordinator_urls}}
   
	
	</service>
	<service>
		<role>DRUID-COORDINATOR</role>
      {{druid_coordinator_urls}}
   
	
	</service>
	<service>
		<role>DRUID-OVERLORD-UI</role>
      {{druid_overlord_urls}}
   
	
	</service>
	<service>
		<role>DRUID-OVERLORD</role>
      {{druid_overlord_urls}}
   
	</service>
	<service>
		<role>DRUID-ROUTER</role>
      {{druid_router_urls}}
   
	
	</service>
	<service>
		<role>DRUID-BROKER</role>
      {{druid_broker_urls}}
   
	
	</service>
	<service>
		<role>ZEPPELINUI</role>
      {{zeppelin_ui_urls}}
   
	
	</service>
	<service>
		<role>ZEPPELINWS</role>
      {{zeppelin_ws_urls}}
   
	
	</service>
</topology>
